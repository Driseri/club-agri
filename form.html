<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–ª—É–±–æ–ì–∏–¥ - –∞–Ω–∫–µ—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="step-age" class="step container active">
    <label>–í–æ–∑—Ä–∞—Å—Ç —Ä–µ–±—ë–Ω–∫–∞</label>
    <input type="number" id="age" min="3" max="18" value="6">
    <div id="ageError" class="error hidden">–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 3 –¥–æ 18 –ª–µ—Ç</div>
    <button id="ageNext">–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-gender" class="step container">
    <label>–ü–æ–ª —Ä–µ–±—ë–Ω–∫–∞</label>
    <label><input type="radio" name="gender" value="boy"> –ú–∞–ª—å—á–∏–∫</label>
    <label><input type="radio" name="gender" value="girl"> –î–µ–≤–æ—á–∫–∞</label>
    <button id="genderNext" disabled>–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-address" class="step container">
    <label>–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
    <input type="text" id="address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å">
    <button id="geo">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ GPS</button>
    <button id="addressNext">–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-transport" class="step container">
    <label>–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ–±—Ä–∞—Ç—å—Å—è</label>
    <select id="transport">
      <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
      <option value="walk">–ü–µ—à–∫–æ–º</option>
      <option value="car">–ù–∞ –º–∞—à–∏–Ω–µ</option>
      <option value="public">–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º</option>
    </select>
    <div style="font-size:0.9rem">–≠—Ç–æ—Ç –≤—ã–±–æ—Ä –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á—ë—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º</div>
    <button id="transportNext" disabled>–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-range" class="step container">
    <label>–í—Ä–µ–º—è –≤ –ø—É—Ç–∏, –º–∏–Ω</label>
    <input type="range" id="time" min="5" max="60" value="30">
    <div id="timeValue">–î–æ 30 –º–∏–Ω</div>
    <button id="rangeNext">–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-interests" class="step container">
    <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
    <div id="selected" class="selected"></div>
    <div class="carousel"><div id="discTrack" class="track"></div></div>
    <div class="swipe-buttons">
      <button id="likeBtn">–ú–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ</button>
      <button id="skipBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
    <button id="finish" disabled>–ü–æ–¥–æ–±—Ä–∞—Ç—å</button>
  </div>
  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const steps = ['step-age','step-gender','step-address','step-transport','step-range','step-interests'];
    let current = 0;
    function showStep(i){
      steps.forEach((id,idx) => {
        const el = document.getElementById(id);
        if(idx === i){
          el.classList.add('active');
          el.classList.remove('hidden');
        } else {
          el.classList.remove('active');
          el.classList.add('hidden');
        }
      });
    }
    showStep(current);

    // Age validation
    const ageInput = document.getElementById('age');
    const ageError = document.getElementById('ageError');
    const ageNext = document.getElementById('ageNext');
    function validateAge(){
      const v = parseInt(ageInput.value,10);
      if(isNaN(v) || v<3 || v>18){
        ageError.classList.remove('hidden');
        ageNext.disabled = true;
      } else {
        ageError.classList.add('hidden');
        ageNext.disabled = false;
      }
    }
    ageInput.addEventListener('input', validateAge);
    validateAge();
    ageNext.onclick = () => { current++; showStep(current); };

    // Gender
    const genderRadios = document.querySelectorAll('input[name="gender"]');
    const genderNext = document.getElementById('genderNext');
    genderRadios.forEach(r=> r.onchange = ()=>{ genderNext.disabled = false; });
    genderNext.onclick = () => { current++; showStep(current); };

    // Address
    document.getElementById('geo').onclick = () => tg.requestLocation();
    document.getElementById('addressNext').onclick = () => { current++; showStep(current); };

    // Transport
    const transport = document.getElementById('transport');
    const transportNext = document.getElementById('transportNext');
    transport.onchange = () => { transportNext.disabled = !transport.value; };
    transportNext.onclick = () => { current++; showStep(current); };

    // Range
    const timeRange = document.getElementById('time');
    const timeValue = document.getElementById('timeValue');
    timeRange.oninput = () => { timeValue.textContent = '–î–æ ' + timeRange.value + ' –º–∏–Ω'; };
    document.getElementById('rangeNext').onclick = () => { current++; showStep(current); };

    // Interests with swipe carousel
    const disciplines = [
      {id:"sport",title:"–°–ø–æ—Ä—Ç",icon:"üèÉ",tag:"–ë—É–¥—å —Å–∏–ª—å–Ω—ã–º"},
      {id:"music",title:"–ú—É–∑—ã–∫–∞",icon:"üé∏",tag:"–ú—É–∑—ã–∫–∞ –¥–ª—è –¥—É—à–∏"},
      {id:"coding",title:"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",icon:"ü§ñ",tag:"–†–∞–∑–≤–∏–≤–∞–π –ª–æ–≥–∏–∫—É"},
      {id:"languages",title:"–Ø–∑—ã–∫–∏",icon:"üìö",tag:"–û—Ç–∫—Ä–æ–π –º–∏—Ä"},
      {id:"art",title:"–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ",icon:"üé®",tag:"–ü—Ä–æ—è–≤–∏ —Ç–∞–ª–∞–Ω—Ç"},
      {id:"science",title:"–ù–∞—É–∫–∞",icon:"üî¨",tag:"–ü–æ–∑–Ω–∞–π –Ω–æ–≤–æ–µ"}
    ];
    const track = document.getElementById("discTrack");
    const likeBtn = document.getElementById("likeBtn");
    const skipBtn = document.getElementById("skipBtn");
    const selected = document.getElementById("selected");
    const finish = document.getElementById("finish");
    let chosen = [];
    disciplines.forEach(d => {
      const card = document.createElement("div");
      card.className = "disc-card";
      card.dataset.value = d.id;
      card.innerHTML = `<div class="icon">${d.icon}</div><div>${d.title}</div><div class="tagline">${d.tag}</div>`;
      attachSwipe(card);
      track.appendChild(card);
    });
    function updateButtons(){ finish.disabled = chosen.length === 0; }
    function checkEnd(){ if(!track.children.length){ likeBtn.disabled = true; skipBtn.disabled = true; } }
    function handleChoice(like){
      const card = track.children[0];
      if(!card) return;
      card.classList.add(like ? "swipe-right" : "swipe-left");
      if(like){
        chosen.push(card.dataset.value);
        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = card.querySelector("div:nth-child(2)").textContent;
        selected.appendChild(chip);
        updateButtons();
      }
      card.addEventListener("animationend", () => { card.remove(); checkEnd(); });
    }
    likeBtn.onclick = () => handleChoice(true);
    skipBtn.onclick = () => handleChoice(false);
    function attachSwipe(el){
      let startX;
      el.addEventListener("pointerdown", e => { startX = e.clientX; });
      el.addEventListener("pointerup", e => { const diff = e.clientX - startX; if(Math.abs(diff) > 50){ handleChoice(diff > 0); } });
    }
    updateButtons();
    finish.onclick = () => location.href = "loading.html";

    tg.onEvent('themeChanged', () => {
      document.body.style.background = tg.themeParams.bg_color || '#f5f5f5';
    });
  </script>
</body>
</html>

