<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö–ª—É–±–æ–ì–∏–¥ - –∞–Ω–∫–µ—Ç–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="tg-init.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="step-age" class="step active">
    <div id="ageOverlay" class="overlay">
      <div id="ageModal" class="age-modal">
        <div class="dial-wrapper">
          <button id="ageMinus" class="circle-btn">&#8722;</button>
          <div id="dial" class="dial"></div>
          <div id="selectedAge" class="selected-age">7 –ª–µ—Ç</div>
          <button id="agePlus" class="circle-btn">+</button>
        </div>
        <input type="text" id="ageInput" class="age-input" value="7">
        <div id="ageError" class="error hidden">–û—Ç 3 –¥–æ 18 –ª–µ—Ç</div>
        <div class="hint">–í–æ–∑—Ä–∞—Å—Ç –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –≥—Ä—É–ø–ø—É</div>
        <button id="ageNext" disabled>–î–∞–ª–µ–µ</button>
      </div>
    </div>
  </div>
  <div id="step-gender" class="step container">
    <label>–ü–æ–ª —Ä–µ–±—ë–Ω–∫–∞</label>
    <div id="genderControl" class="gender-control">
      <label class="gender-segment">
        <input type="radio" name="gender" value="boy">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="5" r="3" />
          <path d="M9 22v-6H7l2-5h6l2 5h-2v6" />
        </svg>
        <span>–ú–∞–ª—å—á–∏–∫</span>
      </label>
      <label class="gender-segment">
        <input type="radio" name="gender" value="girl">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="5" r="3" />
          <path d="M8 22v-4l4-6 4 6v4" />
        </svg>
        <span>–î–µ–≤–æ—á–∫–∞</span>
      </label>
      <label class="gender-segment">
        <input type="radio" name="gender" value="any">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="5" r="3" />
          <rect x="10" y="9" width="4" height="8" />
          <path d="M10 17v4M14 17v4M8 12h8" />
        </svg>
        <span>–ù–µ –≤–∞–∂–Ω–æ</span>
      </label>
    </div>
    <div id="genderError" class="error hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª —Ä–µ–±—ë–Ω–∫–∞</div>
    <button id="genderNext" disabled>–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-address" class="step container">
    <label>–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
    <input type="text" id="address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å">
    <button id="geo">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ GPS</button>
    <button id="addressNext">–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-transport" class="step">
    <label>–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ–±—Ä–∞—Ç—å—Å—è</label>
    <div id="transportControl" class="transport-control">
      <label class="transport-segment">
        <input type="radio" name="transport" value="walk">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2a2 2 0 110 4 2 2 0 010-4zM10 22v-6l-2-4 4-2 2 2h2l3 5v5" />
        </svg>
        <span>–ü–µ—à–∫–æ–º</span>
      </label>
      <label class="transport-segment">
        <input type="radio" name="transport" value="car">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 13l2-5h14l2 5M5 13v5h2v-2h10v2h2v-5" />
          <circle cx="7" cy="18" r="1.5" />
          <circle cx="17" cy="18" r="1.5" />
        </svg>
        <span>–ù–∞ –º–∞—à–∏–Ω–µ</span>
      </label>
      <label class="transport-segment">
        <input type="radio" name="transport" value="public">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <rect x="3" y="5" width="18" height="12" rx="2" />
          <path d="M3 13h18M8 18v2M16 18v2" />
        </svg>
        <span>–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π</span>
      </label>
      <div id="transportAccent" class="accent"></div>
    </div>
    <div id="transportError" class="error hidden">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</div>
    <div class="hint">–≠—Ç–æ—Ç –≤—ã–±–æ—Ä –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á—ë—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º</div>
    <button id="transportNext" disabled>–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-range" class="step container">
    <label>–í—Ä–µ–º—è –≤ –ø—É—Ç–∏, –º–∏–Ω</label>
    <input type="range" id="time" min="5" max="60" value="30">
    <div id="timeValue">–î–æ 30 –º–∏–Ω</div>
    <button id="rangeNext">–î–∞–ª–µ–µ</button>
  </div>
  <div id="step-interests" class="step container">
    <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</label>
    <div class="carousel"><div id="discTrack" class="track"></div></div>
    <div class="swipe-buttons">
      <button id="likeBtn">–ú–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ</button>
      <button id="skipBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
    <div id="selected" class="selected"></div>
    <button id="finish" class="finish-btn" disabled>–ü–æ–¥–æ–±—Ä–∞—Ç—å</button>
  </div>
  <script>

    const steps = ['step-age','step-gender','step-address','step-transport','step-range','step-interests'];
    let current = 0;
    function showStep(i){
      steps.forEach((id,idx) => {
        const el = document.getElementById(id);
        if(idx === i){
          el.classList.add('active');
          el.classList.remove('hidden');
        } else {
          el.classList.remove('active');
          el.classList.add('hidden');
        }
      });
    }
    showStep(current);

    // Age selector
    const ageInput = document.getElementById("ageInput");
    const ageError = document.getElementById("ageError");
    const ageNext = document.getElementById("ageNext");
    const dial = document.getElementById("dial");
    const selectedAgeEl = document.getElementById("selectedAge");
    const ageMinus = document.getElementById("ageMinus");
    const agePlus = document.getElementById("agePlus");
    const stepDeg = 360/16;
    let age = 7;

    function pluralAge(n){
      if(n % 10 === 1 && n % 100 !== 11) return '–≥–æ–¥';
      if([2,3,4].includes(n % 10) && ![12,13,14].includes(n % 100)) return '–≥–æ–¥–∞';
      return '–ª–µ—Ç';
    }

    function createDial(){
      for(let i=3;i<=18;i++){
        const d=document.createElement("div");
        d.className="dial-number";
        d.textContent = i;
        d.dataset.age=i;
        dial.appendChild(d);
      }
    }

    function updateDial(){
      const dialRot = -(age-3)*stepDeg;
      dial.style.transform = "rotate(" + dialRot + "deg)";
      Array.from(dial.children).forEach(el=>{
        const v=parseInt(el.dataset.age,10);
        const angle=(v-3)*stepDeg;
        const active=v===age;
        const scale=active?1.4:1;
        el.style.transform="rotate("+angle+"deg) translate(0,-80px) rotate("+(-angle-dialRot)+"deg) scale("+scale+")";
        el.style.color=active?"var(--tg-theme-button-color, #3390ec)":"";
      });
      selectedAgeEl.textContent = age + ' ' + pluralAge(age);
      ageInput.value=age;
      validateAge();
    }

    function validateAge(){
      const v=parseInt(ageInput.value,10);
      if(isNaN(v)||v<3||v>18){
        ageError.classList.remove("hidden");
        ageNext.disabled=true;
      }else{
        ageError.classList.add("hidden");
        ageNext.disabled=false;
      }
    }

    ageInput.addEventListener("input",()=>{
      const v=parseInt(ageInput.value,10);
      if(!isNaN(v)){ age=Math.max(3,Math.min(18,v)); }
      updateDial();
    });
    ageMinus.onclick=()=>{ if(age>3){ age--; updateDial(); } };
    agePlus.onclick=()=>{ if(age<18){ age++; updateDial(); } };
    let startY;
    dial.addEventListener("pointerdown",e=>{ startY=e.clientY; });
    dial.addEventListener("pointerup",e=>{ const diff=e.clientY-startY; if(Math.abs(diff)>30){ if(diff>0&&age>3) age--; if(diff<0&&age<18) age++; updateDial(); } });
    createDial();
    updateDial();
    ageNext.onclick=()=>{ current++; showStep(current); };


    // Gender segmented control
    const genderInputs = document.querySelectorAll('input[name="gender"]');
    const genderSegments = document.querySelectorAll('.gender-segment');
    const genderControl = document.getElementById('genderControl');
    const genderError = document.getElementById('genderError');
    const genderNext = document.getElementById('genderNext');
    genderInputs.forEach(input => {
      input.addEventListener('change', () => {
        genderSegments.forEach(s => s.classList.remove('selected'));
        input.parentElement.classList.add('selected','pulse');
        setTimeout(()=>input.parentElement.classList.remove('pulse'),150);
        genderNext.disabled = false;
        genderError.classList.add('hidden');
        genderControl.classList.remove('error');
      });
    });
    genderNext.onclick = () => {
      const chosen = document.querySelector('input[name="gender"]:checked');
      if(!chosen){
        genderError.classList.remove('hidden');
        genderControl.classList.add('error');
      } else {
        current++; showStep(current);
      }
    };

    // Address
    document.getElementById('geo').onclick = () => tg.requestLocation();
    document.getElementById('addressNext').onclick = () => { current++; showStep(current); };

    // Transport segmented control
    const transportInputs = document.querySelectorAll('input[name="transport"]');
    const transportSegments = document.querySelectorAll('.transport-segment');
    const transportAccent = document.getElementById('transportAccent');
    const transportControl = document.getElementById('transportControl');
    const transportError = document.getElementById('transportError');
    const transportNext = document.getElementById('transportNext');

    function moveAccent(el){
      transportAccent.style.width = el.offsetWidth + 'px';
      transportAccent.style.left = el.offsetLeft + 'px';
    }

    moveAccent(transportSegments[0]);

    transportInputs.forEach(input => {
      input.addEventListener('change', () => {
        transportSegments.forEach(s => s.classList.remove('selected'));
        const seg = input.parentElement;
        seg.classList.add('selected','jump');
        moveAccent(seg);
        transportAccent.style.opacity = '1';
        setTimeout(()=>seg.classList.remove('jump'),100);
        transportNext.disabled = false;
        transportError.classList.add('hidden');
        transportControl.classList.remove('error');
      });
    });

    transportNext.onclick = () => {
      const chosen = document.querySelector('input[name="transport"]:checked');
      if(!chosen){
        transportError.classList.remove('hidden');
        transportControl.classList.add('error');
        setTimeout(()=>transportControl.classList.remove('error'),200);
      } else {
        current++; showStep(current);
      }
    };

    // Range
    const timeRange = document.getElementById('time');
    const timeValue = document.getElementById('timeValue');
    timeRange.oninput = () => { timeValue.textContent = '–î–æ ' + timeRange.value + ' –º–∏–Ω'; };
    document.getElementById('rangeNext').onclick = () => { current++; showStep(current); };

    // Interests with swipe carousel
    const disciplines = [
      {id:"sport",title:"–°–ø–æ—Ä—Ç",icon:"üèÉ",tag:"–ë—É–¥—å —Å–∏–ª—å–Ω—ã–º"},
      {id:"music",title:"–ú—É–∑—ã–∫–∞",icon:"üé∏",tag:"–ú—É–∑—ã–∫–∞ –¥–ª—è –¥—É—à–∏"},
      {id:"coding",title:"–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",icon:"ü§ñ",tag:"–†–∞–∑–≤–∏–≤–∞–π –ª–æ–≥–∏–∫—É"},
      {id:"languages",title:"–Ø–∑—ã–∫–∏",icon:"üìö",tag:"–û—Ç–∫—Ä–æ–π –º–∏—Ä"},
      {id:"art",title:"–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ",icon:"üé®",tag:"–ü—Ä–æ—è–≤–∏ —Ç–∞–ª–∞–Ω—Ç"},
      {id:"science",title:"–ù–∞—É–∫–∞",icon:"üî¨",tag:"–ü–æ–∑–Ω–∞–π –Ω–æ–≤–æ–µ"}
    ];
    const track = document.getElementById("discTrack");
    const likeBtn = document.getElementById("likeBtn");
    const skipBtn = document.getElementById("skipBtn");
    const selected = document.getElementById("selected");
    const finish = document.getElementById("finish");
    let chosen = [];
    disciplines.forEach(d => {
      const card = document.createElement("div");
      card.className = "disc-card";
      card.dataset.value = d.id;
      card.innerHTML = `<div class="icon">${d.icon}</div><div>${d.title}</div><div class="tagline">${d.tag}</div>`;
      track.appendChild(card);
    });
    function updateButtons(){ finish.disabled = chosen.length === 0; }
    function checkEnd(){ if(!track.children.length){ likeBtn.disabled = true; skipBtn.disabled = true; } }
    function handleChoice(like){
      const card = track.children[0];
      if(!card) return;
      card.classList.add(like ? "swipe-right" : "swipe-left");
      if(like){
        chosen.push(card.dataset.value);
        const chip = document.createElement("span");
        chip.className = "chip";
        chip.textContent = card.querySelector("div:nth-child(2)").textContent;
        selected.appendChild(chip);
        updateButtons();
      }
      card.addEventListener("animationend", () => { card.remove(); checkEnd(); });
    }
    likeBtn.onclick = () => handleChoice(true);
    skipBtn.onclick = () => handleChoice(false);
    updateButtons();
    finish.onclick = () => location.href = "loading.html";

  </script>
</body>
</html>

